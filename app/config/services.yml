# Learn more about services, parameters and containers at
# http://symfony.com/doc/current/service_container.html
parameters:
#    parameter_name: value

services:

    app.form.registration:
        class: AppBundle\Form\RegistrationType
        tags:
            - { name: form.type, alias: app_user_registration }

    ######################################## CRON TASKS #############################################
    app.reminder_contract_artist:
        class: AppBundle\Services\ReminderContractArtist
        arguments:
          em: "@doctrine.orm.entity_manager"
          notifier: "@email.notifier_service"
          mailer: "@azine_email.default.template_twig_swift_mailer"
          logger: "@logger"

    app.reminder_contract_fan:
        class: AppBundle\Services\ReminderContractFan

    ######################################## AZINE EMAIL SERVICES ##########################################
    email.web_view_service:
        class: AppBundle\Services\MailWebViewService
        arguments:
          router:       "@router"

    email.template_provider:
          class: AppBundle\Services\MailTemplateProvider
          arguments:
            router:       "@router"
            translator:   "@translator.default"
            parameters:
              image_dir:  "%azine_email_image_dir%"
              allowed_images_folders: "%azine_email_allowed_images_folders%"
              tracking_params_campaign_name: "%azine_email_tracking_params_campaign_name%"
              tracking_params_campaign_term: "%azine_email_tracking_params_campaign_term%"
              tracking_params_campaign_content: "%azine_email_tracking_params_campaign_content%"
              tracking_params_campaign_medium: "%azine_email_tracking_params_campaign_medium%"
              tracking_params_campaign_source: "%azine_email_tracking_params_campaign_source%"

    email.notifier_service:
            class: AppBundle\Services\MailNotifierService
            arguments:
              mailer:             "@azine_email_template_twig_swift_mailer"
              twig:               "@twig"
              router:             "@router"
              managerRegistry:    "@doctrine"
              templateProvider:   "@email.template_provider"
              recipientProvider:  "@azine_email_recipient_provider"
              translatorService:  "@translator.default"
              parameters:
                newsletter_interval :     "%azine_email_newsletter_interval%"
                newsletter_send_time:     "%azine_email_newsletter_send_time%"
                templates_newsletter:     "%azine_email_templates_newsletter%"
                templates_notifications:  "%azine_email_templates_notifications%"
                templates_content_item:   "%azine_email_templates_content_item%"

    # The following line blocks an error in the AzineEmailBundle which references a non-existent "immediatemailer" service
    swiftmailer.mailer.immediatemailer: "@mailer"

    ######################################## SONATA ADMIN SERVICES ##########################################
    admin.suggestionbox:
        class: AppBundle\Admin\SuggestionBoxAdmin
        arguments: [~, AppBundle\Entity\SuggestionBox, ~]
        tags:
            - { name: sonata.admin, manager_type: orm, label: SuggestionBox }
        public: true

    admin.user:
            class: AppBundle\Admin\UserAdmin
            arguments: [~, AppBundle\Entity\User, ~]
            tags:
                - { name: sonata.admin, manager_type: orm, label: User }
            public: true

    admin.step:
            class: AppBundle\Admin\StepAdmin
            arguments: [~, AppBundle\Entity\Step, ~]
            tags:
                - { name: sonata.admin, manager_type: orm, label: Step }
            public: true

    admin.genre:
            class: AppBundle\Admin\GenreAdmin
            arguments: [~, AppBundle\Entity\Genre, ~]
            tags:
                - { name: sonata.admin, manager_type: orm, label: Genre }
            public: true

    admin.partner:
            class: AppBundle\Admin\PartnerAdmin
            arguments: [~, AppBundle\Entity\Partner, ~]
            tags:
                - { name: sonata.admin, manager_type: orm, label: Partner }
            calls:
                - [setSubClasses, [{hall: AppBundle\Entity\Hall}]]
            public: true