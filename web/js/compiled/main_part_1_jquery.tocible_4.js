(function(e){var i={heading:'h2',subheading:'h3',reference:'.ref',title:'',hash:!1,offsetTop:50,speed:800,collapsible:!0,maxWidth:150};e.fn.tocible=function(o){var t=e.extend({},i,o);return this.each(function(){var o=e(this),i,s,l,n,a;o.find('.tocible').remove();s=o.find(t.reference);s.css({'visibility':'hidden'});a=s.offset().left;i=e('<div/>',{'class':'tocible',html:'<ul/>'});i.css({'max-width':t.maxWidth});o.append(i).css({'position':'relative'});if(t.title){var c=e(t.title).length?e(t.title).text():t.title,f=e('<div/>',{'class':'tocible_header',html:c+'<span/>'});f.prependTo(i).click(function(){e(this).siblings('ul').slideToggle({duration:'slow',step:contain});e(this).find('span').toggleClass('toc_open')})};l=o.find(t.heading);n=o.find(t.subheading);l.add(n).each(function(){var i=e(this),o,c,s,a,f;o=i.attr('id')?'#'+i.attr('id'):'#';c=i.text();if(i.is(l)){s='heading'}
else if(i.is(n)){s='subheading'};a=e('<a/>',{text:c,href:o});f=e('<li/>',{'class':'tocible_'+s});f.append(a).appendTo('.tocible > ul');a.click(function(s){s.preventDefault();var n=i.offset();if(t.hash){var l=e(window).scrollTop();if(history.pushState){history.pushState({},document.title,o)}
else{window.location.hash=o;e(window).scrollTop(l)}};e('html, body').stop(!0).animate({scrollTop:n.top-10},t.speed)})});contain=function(){var l=e(window).scrollTop(),n=o.offset().top;i.css({'top':t.offsetTop,'bottom':'auto','left':a});if(n+o.outerHeight()<=l+i.height()+t.offsetTop){i.css({'position':'absolute','bottom':0,'top':'auto','left':s.position().left})}
else if(l>=n){i.css({'position':'fixed','bottom':'auto','top':t.offsetTop,'left':s.offset().left})}
else{i.css({'position':'absolute','left':s.position().left})}};onScroll=function(){if(t.collapsible){e('.tocible li.tocible_subheading').hide()};l.add(n).each(function(o){var s=e(this),l=s.offset().top,i=e('.tocible li').eq(o),n=e(window).scrollTop();if(n>=l-20){i.addClass('toc_scrolled').siblings().removeClass('toc_scrolled');if(t.collapsible){i.siblings().filter('.tocible_subheading').hide();if(i.is('.tocible_subheading')){i.prevAll('.tocible_heading:first').nextUntil('.tocible_heading').show()}
else if(i.is('.tocible_heading')){i.nextUntil('.tocible_heading').show()}}}
else{i.removeClass('toc_scrolled')}})};e(window).on('resize scroll',function(e){contain();onScroll()}).trigger('scroll')})}})(jQuery);