{% extends "base.html.twig" %}

{% block body %}

    <h1>Viser un palier</h1>
    <p>Vous vous apprêtez à lancer un crowdfunding pour le palier suivant :</p>

    {% include "AppBundle:Entity:step.html.twig" with {'step': contract.step} %}

    <p>En validant le formulaire suivant, vous vous engagez à lire et respecter les <a href="{{ path('conditions') }}">conditions générales</a>.</p>

    {{ form(form) }}

    Date de fin du contrat : {{ contract.theoriticalDeadline|date('d/m') }}

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $('document').ready(function() {
            var $datePicker = $('.datePicker');
            var availableDates = $datePicker.attr('available-dates').toString().split(',');

            function available(d) {
                var mdy = ("0"+(d.getMonth()+1)).slice(-2) + "/" + ("0" + d.getDate()).slice(-2) + "/" +
                        d.getFullYear();

                if($.inArray(mdy, availableDates) < 0) {
                    return false;
                }
                return true;
            }

            function get_default_date() {
                var date = new Date();
                var i = 0;
                var stop = false;
                while(!available(date) && !stop) {
                    date.setDate(date.getDate()+1);
                    i++;
                    if(i == 120) {
                        stop = true;
                    }
                }
                if(stop) { return new Date(); }
                return date;
            }

            $datePicker.datepicker({
                beforeShowDay: function(d) {
                    return [available(d), ''];
                },
                defaultDate: get_default_date(),
                dateFormat: 'mm/dd/yy'
            });
        });
    </script>
{% endblock %}